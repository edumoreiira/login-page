<app-login-register-layout
pageTitle="Painel de controle dos usuários"
[disableAllButtons]="true"
[largeContent]="true"
>
<section class="registry">
    <div class="registry__config">
        <div class="registry__search-bar">
            <app-input
            type="text"
            placeholder="Pesquisar"
            ></app-input>
        </div>
        <div class="registry__options">
            <div class="registry__columns-control">
                <app-dropdown-selection
                name="Colunas"
                [items]="tableColumns"
                (clickedItem)="changeTable($event.name)"
                >

                </app-dropdown-selection>
            </div>
        </div>
    </div>
    <div class="registry__table__container">
        <table class="registry__table">
            <thead class="registry__header-body">
                <tr class="registry__header-row">
                    @for(column of tableColumns; track $index){

                        @if(column.isActive){
                            <th class="registry__header-cell registry__header-cell--id" @slide>{{column.name}}</th>
                        }
                    }
                    <th class="registry__header-cell registry__header-cell--actions"></th>
                </tr>
            </thead>
            <tbody class="registry__body">
                <tr *ngFor="let user of users$ | async" class="registry__row">
                    @if (tableColumns[0].isActive) {
                        <td class="registry__cell registry__cell--id" [title]="user.id" @slide>
                            <span class="registry__item">{{user.id}}</span>
                        </td>
                    }
                    @if (tableColumns[1].isActive) {
                        <td class="registry__cell registry__cell--name" [title]="user.name" @slide>
                            <span class="registry__item">{{user.name}}</span>
                        </td>
                    }
                    @if (tableColumns[2].isActive) {
                        <td class="registry__cell registry__cell--birthDate" [title]="user.birthDate" @slide>
                            <span class="registry__item">{{user.birthDate}}</span>
                        </td>
                    }
                    @if (tableColumns[3].isActive) {
                        <td class="registry__cell registry__cell--email" [title]="user.email" @slide>
                            <span class="registry__item">{{user.email}}</span>
                        </td>
                    }
                    @if (tableColumns[4].isActive) {

                        <td class="registry__cell registry__cell--username" [title]="user.username" @slide>
                            <span class="registry__item">{{user.username}}</span>
                        </td>
                    }
                    @if (tableColumns[5].isActive) {
                        <td class="registry__cell registry__cell--password" 
                        [title]="password.classList.contains('registry__item--censored') ? 'Censored' : user.password" @slide>
                            <span #password class="registry__item registry__item--censored" 
                            (click)="toggleShowPassword($event)">{{user.password}}</span>
                        </td>
                    }
                    <td class="registry__cell registry__cell--actions">
                        <button type="button" class="registry__edit-button" (click)="addRowToFormGroup(user, $event)">Editar</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="registry__controllers">
        <div class="registry__panel-edit-button">
            <app-button name="Painel de edição" 
            type="filled"
            [isDisabled]="usersToEdit.length > 0 ? false : true"
            (onClick)="isEditorActive = true"></app-button>
        </div>
        <div class="registry__paginator">
            <app-button name="Anterior" [isDisabled]="true"></app-button>
            <app-button name="Próximo"></app-button>
        </div>
    </div>
</section>




<section *ngIf="isEditorActive" class="editor" @parentAnimation>
    <div class="editor__background" (click)="isEditorActive = false" @fadeInOut></div>
    <div class="editor__foreground" @popUp>
        <h1 class="editor__title">Editor de registro</h1>
        <div class="editor__table__container">
            <form [formGroup]="userForm">
                <table class="editor__table">
                    <thead class="editor__header-body">
                        <tr class="editor__header-row">

                            @for(column of tableColumns; track $index){
                                <th class="editor__header-cell editor__header-cell--id">{{column.name}}</th>
                            }

                            <th class="editor__header-cell editor__header-cell--actions"></th>
                        </tr>
                    </thead>
                    <tbody class="editor__body" formArrayName="user">
                        <tr *ngFor="let user of users().controls; let i = index"
                        [formGroupName]="i" class="editor__row">
                            
                            <!-- <td class="editor__cell editor__cell--id" [title]="user.id">
                                <span class="editor__item--id">{{user.id}}</span>
                            </td> -->
                            
                            <td class="editor__cell editor__cell--name" [title]="nameInput.value">
                                <input  #nameInput [value]="'user.name'" type="text" class="editor__input"
                                [ngClass]="{'editor__input--modified': nameInput.value !== 'user.name'}"
                                formControlName="name">
                            </td>
                            
                            <!-- <td class="editor__cell editor__cell--birthDate" [title]="user.birthDate">
                                <input #birthDateInput [value]="user.birthDate" type="date" class="editor__input"
                                [ngClass]="{'editor__input--modified' : birthDateInput.value !== user.birthDate}"
                                formControlName="birthDate">
                            </td>
                            
                            <td class="editor__cell editor__cell--email" [title]="emailInput.value">
                                <input #emailInput [value]="user.email" type="text" class="editor__input"
                                [ngClass]="{'editor__input--modified' : emailInput.value !== user.email}"
                                formControlName="email">
                            </td>
                        
                            <td class="editor__cell editor__cell--username" [title]="usernameInput.value">
                                <input #usernameInput [value]="user.username" type="text" class="editor__input"
                                [ngClass]="{'editor__input--modified' : usernameInput.value !== user.username}"
                                formControlName="username">
                            </td>
                            

                            <td class="editor__cell editor__cell--password" [title]="passwordInput.value">
                                <input #passwordInput [value]="user.password" type="text" class="editor__input"
                                [ngClass]="{'editor__input--modified' : passwordInput.value !== user.password}"
                                formControlName="password">
                            </td> -->

                            <td class="editor__cell editor__cell--actions">
                                <!-- <button type="button" class="editor__apply-button" (click)="addRowToEditList(user, $event)">Aplicar</button> -->
                                <app-button
                                name="Aplicar"
                                type="filled"
                                
                                ></app-button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </form>
        </div>
        <div class="editor__controllers">
            <app-button
            name="Aplicar todos"
            type="filled"
            [isExpanded]="true"
            ></app-button>
        </div>
    </div>
</section>


</app-login-register-layout>